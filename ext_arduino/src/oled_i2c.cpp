
#include "config.h"
#include "system.h"
#include "core_uart.h"
#include "core_twi.h"
#include "ssd1306.h"
#include "glib.h"
#include "U8glib.h"

static unsigned char u8g_logo_bits[] U8G_PROGMEM = {
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		// 0
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		// 1
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		// 2
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xF0,0x3C,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0xF0,0x3C,0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x78,0x3C,0x00,0x00,0x00,0xC0,0xDD,0x01,0x00,0x00,0x00,0x00,0x00,0x00,		// 3
	0x00,0x00,0x78,0x3C,0x00,0x00,0x00,0xE0,0x9C,0x03,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x3C,0x3C,0x3C,0x00,0xEF,0xFF,0xE0,0xBE,0xE3,0xFF,0x81,0x7F,0xF8,0x0F,0x00,
	0x00,0x3C,0x1E,0x3C,0x00,0xEF,0xFF,0x61,0x3E,0xE3,0xFF,0xC3,0xFF,0xF8,0x1F,0x00,
	0x00,0x78,0x1E,0x3C,0x00,0xEF,0xFF,0x31,0x7F,0xC3,0xFF,0xE7,0xFF,0xF9,0x1F,0x00,
	0x00,0x00,0x00,0x3C,0x1E,0x0F,0xC0,0x39,0x7F,0x06,0x80,0xE7,0xE1,0x01,0x00,0x00,
	0x00,0x00,0x00,0x3C,0x1E,0x0F,0xE0,0xB9,0x7F,0x0E,0xFE,0xF7,0xC0,0xC3,0x01,0x00,
	0x00,0xE0,0x07,0x3C,0x1E,0x8F,0xFB,0xB9,0x7F,0x0E,0xFF,0xF3,0xC0,0xC3,0x01,0x00,
	0x00,0xC0,0x03,0x3C,0x1E,0x8F,0xFB,0x30,0x77,0x06,0xFF,0xF3,0xC0,0xC3,0x01,0x00,		// 4
	0x00,0xC0,0x03,0x3C,0x1E,0x8F,0x7B,0x60,0x37,0x03,0xFF,0xF7,0xC0,0xC3,0x01,0x00,
	0x00,0xC0,0x03,0x3C,0x80,0x8F,0xF3,0x60,0x94,0x03,0x80,0xF7,0xE1,0xC3,0x01,0x00,
	0x00,0xC0,0x03,0xFC,0xF3,0x87,0xE3,0xE1,0xC1,0x03,0xFE,0xE7,0xFF,0xC1,0x01,0x00,
	0x00,0xC0,0x03,0xF8,0xFF,0x87,0xE3,0xC1,0xFF,0x01,0xFF,0xC3,0xFF,0xC0,0x01,0x00,
	0x00,0xC0,0x03,0xF0,0xFF,0x81,0xC3,0x03,0x3E,0x00,0xFF,0x83,0x7F,0xC0,0x01,0x00,
	0x00,0xC0,0x03,0x80,0x7F,0x80,0x83,0x07,0x1C,0x00,0xFF,0x00,0x1E,0xC0,0x01,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		// 5
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		// 6
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,		// 7
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

U8GLIB_SSD1306_128X64 u8g( 0x3c );	// U8G_I2C_OPT_NONE);



//////////////////////////////////////////////////////////////////////
//
//////////////////////////////////////////////////////////////////////
void oledInit( )
{
#if OLED_DEV==1

	ssd1306_init( );
	glInit( );
	
	glBitBlt( 0, 0, u8g_logo_bits, 128, 64 );
	uint16 size;
	uint8* buf = glGetFrameBuf( &size );
	
	ssd1306_update( buf, size );

#else

	u8g.initI2C( 0x3c );
	u8g.firstPage();
	do {
		u8g.drawXBMP( 0, 0, 128, 64, u8g_logo_bits);
	} while( u8g.nextPage() );
	
	u8g.setFont( u8g_font_unifont );
	
#endif	
}

void oledSetPos( int x, int y )
{
	u8g.setPrintPos( x*32, y*32 );
}

void oledPrint( int x, int y, const char* str )
{
	u8g.drawStr( x*20, y*20 + 20, str );
}

void oledStart( )
{
	u8g.firstPage();
}

uint8 oledNextPage( )
{
	return u8g.nextPage();
}

void oledTest( )
{
	return;
	u8g.drawLine( 0, 0, 127, 63 );
}

void oledDevTest( )
{
	return;
	glClearBuf( );
	
	glDrawLine( 0, 0, 50, 50 );
	
	uint16 size;
	uint8* buf = glGetFrameBuf( &size );
	
	ssd1306_update( buf, size );
}

/////////////////////////////////////////////////////////////////////
//
/////////////////////////////////////////////////////////////////////
void oledSetContrast( uint8 con )
{
	ssd1306_cmd( SSD1306_CONTRAST );
	ssd1306_cmd( con );
}

void oledSetEntireDisp( bool on )
{
	ssd1306_cmd( on ? SSD1306_DISP_ALL_ON : SSD1306_DISP_RESUME );
}

void oledSetInverseDisp( bool en )
{
	ssd1306_cmd( en ? SSD1306_DISP_INVERSE : SSD1306_DISP_NORMAL );
}

void oledSetDisp( bool on )
{
	ssd1306_cmd( on ? SSD1306_DISP_ON : SSD1306_DISP_OFF );
}

